<!DOCTYPE html>
<html>
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Temperature</title>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
  <style type="text/css">
    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }

    .line {
      fill: none;
      stroke: steelblue;
      stroke-width: 1.5px;
    }
  </style>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
 </head>
 <body>
  <nav class="navbar navbar-default" role="navigation">
    <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Temperature</a>
    </div>

    <div class="collapse navbar-collapse" id="navbar-collapse-1">
      <ul class="nav navbar-nav navbar-left">
        <li><a href="#">Link</a></li>
      </ul>
    </div>
    </div>
  </nav>
  <div class="container">
    <h2>Temperatures</h2>
    <svg id="tempgraph"></svg>
  </div>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script>
    (function() {
      var timeformat = d3.time.format.utc('%Y-%m-%d %H:%M:%S');
        
      function formatRow(row) {
          row[0] = timeformat.parse(row[0]);
          row[1] = +row[1] * 9 / 5 + 32;
      }
        
      d3.text('temps.csv', function(data) {
        var temps = d3.csv.parseRows(data);
        temps.forEach(formatRow);
        
        var margin = {top: 20, right: 20, bottom: 30, left: 80},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        var x = d3.time.scale()
            .range([0, width]);

        var y = d3.scale.linear()
            .range([height, 0]);

        x.domain([temps[0][0], temps[temps.length-1][0]]);
        y.domain(d3.extent(temps, function(d) { return d[1]; }));
          
        var xAxis = d3.svg.axis()
            .scale(x)
            .orient('bottom')
            .tickFormat(d3.time.format('%m/%d %H:%M'));

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient('left');

        var line = d3.svg.line()
            .x(function(d) { return x(d[0]); })
            .y(function(d) { return y(d[1]); });

        var svg = d3.select('#tempgraph')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
          .append('g')
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

        svg.append('g')
            .attr('class', 'x axis')
            .attr('transform', 'translate(0,' + height + ')')
            .call(xAxis);

        svg.append('g')
            .attr('class', 'y axis')
            .call(yAxis)
          .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', 6)
            .attr('dy', '.71em')
            .style('text-anchor', 'end')
            .text('Temperature (F)');
            
        svg.append('path')
            .datum(temps)
            .attr('class', 'line')
            .attr('d', line);
            
        setInterval(function() {
          d3.text('temps.csv', function(data) {
            var temps = d3.csv.parseRows(data);
            temps.forEach(formatRow);
            
            x.domain([temps[0][0], temps[temps.length-1][0]]);
            y.domain(d3.extent(temps, function(d) { return d[1]; }));

            svg.select('.line')
                .datum(temps)
                .attr('d', line);
                
            svg.select('.x.axis')
                .call(xAxis);
                
            svg.select('.y.axis')
                .call(yAxis);
          });
        }, 60000);
      });
    })();
  </script>
 </body>
</html>